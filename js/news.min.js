const rev="—2P10M2247—";class Page{"use strict";constructor(t={}){if(Page._instance)throw new Error("Page can only be instantiated once!");Page._instance=this;const e={links:void 0,backgrounds:void 0,info:document.querySelector("#info"),host:location.host,left:"&#8619;",right:"&#8620;",cookie:!0};this.opt=Object.assign(e,t),this.bg={style:0,list:[],caption:document.querySelector("#bg-caption"),switch:document.querySelector("#bg-switch"),style_switch:document.querySelector("#bg-style-switch")},this.tab={id:0,count:0,last:"tabx",tags:Object.values(document.querySelectorAll("[id^='tab']")).map((t=>t.id))},this.page={info:[],id:document.querySelector("#page"),error:document.querySelector("#error")},this.clock(this.opt.info,this.opt.host),setInterval(this.clock,1e3,this.opt.info,this.opt.host),this.starting()}starting(){!(typeof this.opt.backgrounds).match(/undefined/)&&Array.isArray(this.opt.backgrounds)&&(this.bg.list=this.opt.backgrounds),0==this.bg.list.length&&(this.bg.switch.hidden=this.bg.style_switch.hidden=!0),1==this.bg.list.length&&(this.bg.style_switch.hidden=!0),this.tab.count=this.tab.tags.length-1,this.change_background_style(!1),(typeof this.opt.links).match(/undefined/)&&""===this.opt.links?fetch(".data"):this.populate(this.opt.links),this.switch_page(),this.bg.switch.addEventListener("click",(()=>this.change_background())),this.bg.style_switch.addEventListener("click",(()=>this.change_background_style())),window.addEventListener("keyup",(t=>{switch(t.keyCode){case 13:this.change_background();break;case 113:this.change_background_style();break;case 19:case 37:this.switch_page(this.tab.id-1);break;case 45:case 39:this.switch_page(this.tab.id+1)}})),[...Array(this.tab.count).keys()].forEach((t=>{document.querySelector("#tab"+t).addEventListener("mouseover",(()=>this.switch_page(t)))}))}clock(t,e){const s=new Date,i=s.toLocaleString("default",{weekday:"long"}),n=1900+s.getYear(),a=s.getDate(),o=1+s.getMonth(),c=[s.getHours(),s.getMinutes(),s.getSeconds()].map((t=>t<10?"0"+t:t)).join(":");t.innerHTML=`${e} &#x263C; ${i} ${o}/${a}/${n} &#x263C; ${c}`}fill(t,e=""){const s=(t.match(/\-/g)||[]).length;return e?`<p><a href='https://${t}'>&nbsp;${e}&nbsp;</a></p>`:"<br>".repeat(s)}get_cookie(t,e){let s=new RegExp(t+"=([0-9]+)");try{return document.cookie.match(s)[1]%e}catch(t){return 0}}fetch(t){fetch(t).then((t=>{200===t.status?t.text().then((t=>{this.populate(t)})):this.error("reading data file")})).catch((t=>{this.error(t)}))}populate(t){const e={comment:/^\s*[;#].*$/,section:/^\s*\[\s*([^\]]*)\s*\]\s*$/,link:/^\s*([^\|]+?)\s*\|\s*(.*?)\s*$/,empty:/^-.*$/};let s,i={},n=null;t.split(/\r?\n/).map((t=>t.trim())).forEach((t=>{t&&!e.comment.test(t)&&(e.section.test(t)?(s=t.match(e.section),n=s[1],i[n]=""):e.link.test(t)?(s=t.match(e.link).map((t=>t.trim())),n&&(i[n]+=this.fill(s[1],s[2]))):e.empty.test(t)&&(s=t.match(e.empty),n&&(i[n]+=this.fill(s[0]))))}));let a=Object.values(i);a.length?(a.length<2*this.tab.count&&(a=[...a,...Array(2*tab.count-a.length)]),[...Array(this.tab.count).keys()].forEach((t=>{const e=t==this.tab.count-1?`<span id='rev'>${rev}</span>`:"";this.page.info[t]=` \n <div class='content'>\n <div class='left column'> ${a[2*t]} </div>\n <div class='right column'> ${a[2*t+1]} </div>\n </div>\n ${e}\n `}))):error("no news links in data")}switch_page(t=""){0===t.length&&(t=this.opt.cookie?this.get_cookie("tab",this.tab.count):0),t<0&&(t=this.tab.count-1),t>this.tab.count-1&&(t=0);const e="tab"+t;this.tab.tags.includes(e)&&e!==this.tab.last&&(this.page.info[t]&&(this.page.id.innerHTML=this.page.info[t]),this.tab.tags.includes(this.tab.last)&&(document.querySelector("#"+this.tab.last).className=""),document.querySelector("#"+e).className="active",this.tab.last=e,this.tab.id=t,this.opt.cookie&&(document.cookie=`tab=${t}`))}change_background_style(t=!0){t&&(this.bg.style=Math.floor(Math.random()*this.bg.list.length)),this.bg.style_switch.innerHTML=this.bg.style?this.opt.left:this.opt.right,this.change_background()}change_background(){const t=(this.bg.list[this.bg.style]||"").trim().split(/\r?\n/),e=t[Math.floor(Math.random()*t.length)].split(/\|/).map((t=>t.trim())),s=e[0]||"lightblue";this.bg.caption.innerHTML=s,document.documentElement.style.setProperty("--bg-color",s);const i=e[1]||"";1==e.length&&(this.page.id.style.backgroundImage=""),2==e.length&&(this.page.id.style.backgroundImage=`url(${i})`)}error(t){page.error.innerHTML=`<span class='error'>Error -> ${t}</span>`}}
